from transformers import AutoTokenizer, AutoModelForCausalLM
import torch

# Load the merged model and tokenizer
model_path = "/nethome/hhelbig/Neural_Networks/LLM_tuning/merged_llama3"

tokenizer = AutoTokenizer.from_pretrained(model_path)
model = AutoModelForCausalLM.from_pretrained(
    model_path,
    torch_dtype=torch.float16,
    device_map="auto"
)

# Test prompt
prompt = "Eine Person hat folgende Eigenschaften und hat folgende Angaben gemacht. Auf der Basis dieser Angaben, wird diese Person ihre Krankenversicherung wechseln: Bitte antworte mit \"Nicht-Wechsler ohne Wechselgedanken l10y\", \"Nicht-Wechsler mit Wechselgedanken l10y\" oder \"Wechsler l10y\".\n\nSoziodemografie:\nDie Person ist Männlich, ist 31 Jahre alt, lebt in Sachsen-Anhalt, In der gesetzlichen Krankenversicherung versichert, verdient 40.000 € bis 66.599 €.\n\nHaushalt & Beruf:\nHaushaltsgröße: 1 Personen, Migrationshintergrund: Ja, aus: Westasien (Naher Osten), arbeitet: Vollzeit, Berufserfahrung: 5 bis unter 10 Jahre, Beziehungsstatus: Single.\n\nMarkenbekanntheit: Die Person kann folgende Krankenkassen ohne Hinweis nennen:\nAok, Dak, Fkk, Bramer, Kka, Die Person kennt folgende Krankenkassen, wenn sie genannt werden: AOK, IKK classic, IKK gesund plus, IKK Südwest, DAK Gesundheit, KKH Kaufmännische Krankenkasse, Barmer, BKK VBU.\n\nNutzung & Wechsel:\nist bei der AOK versichert, hat über einen Wechsel Vor weniger als 1 Jahr nachgedacht.\n\nWissen / Selbstwahrnehmung:\nschätzt ihr Wissen über GKV als Mittel ein.\n\nWechselgründe – allgemein & konkret: Die Person gibt folgendes als Wechselgründe an:\nVertriebliche Ansprache durch andere Krankenkasse (z.B. durch Kontaktaufnahme Vertriebsmitarbeiter etc.), Die Person antwortet auf folgende Frage: Was war der Hauptgrund für Ihren letzten Wechsel?, mit: Vertriebliche Ansprache durch andere Krankenkasse (z.B. durch Kontaktaufnahme Vertriebsmitarbeiter etc.), Die Person antwortet auf folgende Frage: Bitte geben Sie genauer an, was der Hauptgrund für Ihren letzten Wechsel war., mit: Persönliche Kontaktaufnahme durch Vertriebsmitarbeitende.\n\nZufriedenheit / Leistungsbewertung:\nDie Person bewertet die Aussage: Sehr gutes Angebot eines Bonusprogramms z.B. Zusätzliche Gesundheits-Check-Ups, Auszahlungen, Sportprogramme etc als 'Trifft eher zu' bei der eigenen Krankenkasse, bewertet die Aussage :Hervorragendes Angebot zusätzlicher Leistungen (z.B. Zahnreinigung, Osteopathie, Kurse und Programme zur Gesundheitsvorsorge wie Rückenschule, Raucherentwöhnung oder Gewichtsreduktion, etc als 'Trifft eher nicht zu' bei der eigenen Krankenkasse, bewertet die Aussage: Größtes Angebot an weiteren Zusatzversicherungen z.B. Zahnzusatz, Auslandskrankenschutz etc als 'Weder noch' bei der eigenen Krankenkasse, bewertet die Aussage:Tarife mit Beitragsrückerstattungen z.B. Wahltarif oder Gutscheinen für Zusatzleistungen bei gesundheitsbewusstem Verhalten als 'Trifft eher nicht zu' bei der eigenen Krankenkasse, bewertet die Aussage: Besondere Versorgungsangebote z.B. besondere Versorgung für spezifische Erkrankungen, Arztterminvermittlung, Zweitmeinung, telemedizinische Versorgung, etc. als 'Weder noch' bei der eigenen Krankenkasse, bewertet die Aussage: Vorreiter in Sachen Innovation bspw. Telemedizin als 'Trifft eher nicht zu' bei der eigenen Krankenkasse, bewertet die Aussage: Exzellente Beratung zu verschiedenen Gesundheitsthemen (z.B. zu Leistungen, Vorsorgeuntersuchungen, Krankheiten und Präventionsmaßnahmen als 'Weder noch' bei der eigenen Krankenkasse, bewertet die Aussage: Umfangreicher digitaler Kundenservice z.B. Live-/Videochat, Apps, Chatbot, papierlose Dokumentenübermittlung, etc. als 'Trifft eher zu' bei der eigenen Krankenkasse, bewertet die Aussage: Uneingeschränkte Erreichbarkeit des Kundenservice z.B. Öffnungszeiten, Geschäftsstelle vor Ort als 'Trifft eher nicht zu' bei der eigenen Krankenkasse, bewertet die Aussage: Äußerst vertrauensvoller und unterstützender Kundenumgang als 'Trifft eher nicht zu' bei der eigenen Krankenkasse, bewertet die Aussage: Schnellstmögliche Bearbeitung von Anliegen als 'Weder noch' bei der eigenen Krankenkasse, bewertet die Aussage: Niedriger Preis (Geringer Zusatzbeitrag im Vergleich zu anderen Krankenkassen) als 'Weder noch' beid der eigenen Krankenkasse, bewertet die Aussage: Hervorragender Ruf der Krankenkasse als 'Trifft eher nicht zu' bei der eigenen Krankenkasse, bewertet die Aussage: Nachweisliches Engagement der Krankenkasse zum Thema Nachhaltigkeit als 'Weder noch' bei der eigenen Krankenkasse.\n\nLoyalität / Empfehlung:\nDie Person fühlt sich ihrer GKV Eher nicht verbunden , auf einer Skala von 1 bis 10 würde ihre Krankenkasse mit '3/10' weiterempfehlen, Begründung für Weiterempfehlung: \"7\".\n\nInformationsverhalten & Abschluss:\nDie Person informiert sich über Webseiten der Krankenkassen, Telefonische Beratung bei den Krankenkassen, Social Media und Internetforen, die ausschlaggebende Informationsquelle ist: Webseiten der Krankenkassen, der bevorzugte Abschlusskanal ist: Über einen Versicherungsmakler.\n\nWechselbarrieren:\nDie Person fühlt sich auf einer Skala von 1 bis 13 'Rank 2/13' verbunden mit der Krankenkasse, Die Person bewertet auf einer Skala von 1 bis 13 die Schwierigkeiten, das Leistungsangebot der Krankenkassen zu vergleichen als 'Rank 1/13', auf einer Skala von 1 bis 13, bewertet die Person die Aussage: Es ist mir nicht wichtig, bei welcher Krankenkasse ich versichert bin als 'Rank 2/13'.\n\nPreisakzeptanz:\nhält einen Wechsel bei einem Zusatzbeitrag für Eher wahrscheinlich.\n\nKontaktverhalten:\nOnline Kontakt mit GKV: ca. 3 bis 6-mal im Jahr, telefonischer Kontakt mit GKV: ca. 7-12-mal im Jahr, Kontakt in Geschäftsstelle: ca. 7-12-mal im Jahr, Briefkontakt mit GKV: ca. 7-12-mal im Jahr, bevorzugter Kontaktweg mit der GKV: E-Mail, bevorzugter Kontaktaufnahme von der GKV: Per Brief, letzter Kontakt war: Vor 7 - 12 Monaten, kontaktierte die GKV wegen Beantragung Versichertenkarte, bewertet den Kontakt mit der GKV als Neutral.\n\nZusatzversicherungen & weitere Anbieter:\nDie Person hat folgende Zusatzversicherungen: \"0\", Zusatzversicherung Anbieter: Ja, ich habe einen Teil der Zusatzversicherungen über meine Krankenkasse bzw. einen Kooperationspartner abgeschlossen.\n\nAndere Verträge::\nStrom-/Gasanbieter: Wechsel liegt länger zurück, Mobilfunkanbieter: 1-mal gewechselt, Internetanbieter: Noch nie gewechselt, Kfz-Versicherung: 1-mal gewechselt.\n\nPKV Wechsel:\nGedanken zum Wechsel in die PKV: Ja, ich habe mir Gedanken zu einem Wechsel gemacht, Wechselgründe: Eingeschränkter Umfang bei der Abdeckung von Leistungen, Gefahr von höheren Beitragsanpassungen, Angst vor Ablehnung oder hohen Beiträgen durch Vorerkrankungen, Wechselinteresse zur PKV: Eher unwahrscheinlich.\n\nGesundheit & Prävention:\nDie Person trifft folgende Gesundheitsvorsorge: Ich treibe mehrmals die Woche intensiv Sport, Gesundheit spielt für mich keine große Rolle, hat folgende Erkrankungen: Asthma, Chronische Nierenerkrankung, weitere Erkrankungen: Asthma, COPD, KHK (Koronare Herzkrankheit)."


# Tokenize and generate
inputs = tokenizer(prompt, return_tensors="pt").to("cuda")
outputs = model.generate(**inputs, max_new_tokens=300)

generated_tokens = outputs[0][inputs['input_ids'].size(1):]

# Decode only the newly generated tokens
answer = tokenizer.decode(generated_tokens, skip_special_tokens=True)

print(answer)
